<!DOCTYPE html>
<html>
<head>
    <title>Taksi sluzba</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="proba.css">

    <script src="Scripts/jquery-1.10.2.js"></script>
    <script src="Scripts/jquery.validate.js"></script>
    <script src="Scripts/mojeskripte/functions.js"></script>

    <script type="text/javascript">
        function openPage(pageName, elmnt, color) {
            // Hide all elements with class="tabcontent" by default */
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            // Remove the background color of all tablinks/buttons
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }
            // Show the specific tab content
            document.getElementById(pageName).style.display = "block";
            // Add the specific color to the button used to open the tab content
            elmnt.style.backgroundColor = color;
        }

        function formiraj() {
            alert($("#lokacijaVoznje").val());

            $.ajax({
                url: 'api/dispecerVoznja/post',
                method: 'POST',
                data: {
                    LokacijaTaksija: $("#lokacijaVoznje").val(),
                    Vozac: $("#vozacSelect").val(),
                    TipVozila: $("#tipAutomobila").val()
                }
            });

        }

        function obradi() {
            $.get("/api/dispecerObradaVoznje", function (data, status) {
                var i;

                for (i = 0; i < data.length; i++) {
                    if ($("#check" + i).prop('checked')) {
                        $.ajax({
                            url: 'api/voznjeDispecer/post',
                            method: 'POST',
                            data: {
                                Adresa: data[i].LokacijaTaksija.Adresa,
                                Vozac: document.getElementById("obradiVoznjuVozac").value,
                            },
                            success: function (data) {
                                startDispecer();
                            }
                        });
                    }
                }
            });
        }

    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            jQuery('#Myprofile').click();
            $("#Myprofile").click(function () {
                $.get("/api/dispecer", function (data, status) {
                    $("#korisnickoIme").val(data.KorisnickoIme);
                    $("#ime").val(data.Ime);
                    $("#prezime").val(data.Prezime);
                    $("#kontaktTelefon").val(data.KontaktTelefon);
                    if (data.Pol == 0) {
                        $("#Muski").attr("selected", "true");
                    }
                    else {
                        $("#Zenski").attr("selected", "true");
                    }
                    $("#lozinka").val(data.Lozinka);
                    $("#jmbg").val(data.Jmbg);
                    $("#email").val(data.Email);
                    $("#uloga").val(data.Uloga);
                    $("#voznje").val(data.VoznjeKorisnika);
                });
            });
            $("#FormirajVoznjuTab").click(function () {
                $.get("/api/dispecerVoznja", function (data, status) {
                    $("#vozacSelect").empty();
                    var i;
                    for(i = 0; i < data.length;i++)
                    {
                        var s = $("<option value=\"" + data[i].KorisnickoIme + "\" >" + data[i].KorisnickoIme + "</option>").attr("id", data[i].KorisnickoIme);
                        $("#vozacSelect").append(s);
                    }
                });
            });
            $("#pocetna").click(function () {
                $("#tabelaPocetna").empty();
                var t1 = $("<td></td>").text("Lokacija");
                var t2 = $("<td></td>").text("Vreme zahteva");
                var t3 = $("<td></td>").text("Tip vozila");
                var t4 = $("<td></td>").text("Musterija");
                var t5 = $("<td></td>").text("Vozac");
                var t6 = $("<td></td>").text("Iznos");
                var t7 = $("<td></td>").text("Stanje voznje");
                var t8 = $("<td></td>").text("Komentar");
                var t9 = $("<td></td>").text("Datum Komentara");
                var t10 = $("<td></td>").text("Ocena");
                $("#tabelaPocetna").append("<tr>",t1,t2,t3,t4,t5,t6,t7,t8,t9,t10,"</tr>");

                $.get("/api/dispecerLicneVoznje", function (data, status) {
                    var i;
                    var tip;
                    var tipVoznje;
                    for (i = 0; i < data.length; i++) {
                        var s1 = $("<td></td>").text(data[i].Odrediste.Adresa);
                        var s2 = $("<td></td>").text(data[i].Datum);
                        if (data[i].TipVozila == 0) {
                            tip = "Putnicki";
                        }
                        else if (data[i].TipVozila == 1) {
                            tip = "Kombi";
                        }
                        else if (data[i].TipVozila == 2) {
                            tip = "Podrazumevani";
                        }
                        var s3 = $("<td></td>").text(tip);
                        var s4 = $("<td></td>").text(data[i].Musterija);
                        var s5 = $("<td></td>").text(data[i].Vozac);
                        var s6 = $("<td></td>").text(data[i].Iznos);
                        if (data[i].StatusVoznje == 0) {
                            tipVoznje = "Kreirana";
                        }
                        else if (data[i].StatusVoznje == 1) {
                            tipVoznje = "Otkazana";
                        }
                        else if (data[i].StatusVoznje == 2) {
                            tipVoznje = "Formirana";
                        }
                        else if (data[i].StatusVoznje == 3) {
                            tipVoznje = "Odradjena";
                        }
                        else if (data[i].StatusVoznje == 4) {
                            tipVoznje = "Prihvacena";
                        }
                        else if (data[i].StatusVoznje == 5) {
                            tipVoznje = "Neuspesna";
                        }
                        else if (data[i].StatusVoznje == 6) {
                            tipVoznje = "Uspesna";
                        }
                        var s7 = $("<td></td>").text(tipVoznje);
                        var s8 = $("<td></td>").text(data[i].Komentar.Opis);
                        var s9 = $("<td></td>").text(data[i].Komentar.DatumObjave);
                        var s10 = $("<td></td>").text(data[i].Komentar.OcenaVoznje);

                        $("#tabelaPocetna").append("<tr>", s1,s2,s3,s4,s5,s6,s7,s8,s9,s10,"</tr>");
                    }
                });
                $("#tabelaPocetna2").empty();
                var t1 = $("<td></td>").text("Lokacija");
                var t2 = $("<td></td>").text("Vreme zahteva");
                var t3 = $("<td></td>").text("Tip vozila");
                var t4 = $("<td></td>").text("Musterija");
                var t5 = $("<td></td>").text("Vozac");
                var t6 = $("<td></td>").text("Iznos");
                var t7 = $("<td></td>").text("Stanje voznje");
                var t8 = $("<td></td>").text("Komentar");
                var t9 = $("<td></td>").text("Datum Komentara");
                var t10 = $("<td></td>").text("Ocena");
                $("#tabelaPocetna2").append("<tr>", t1, t2, t3, t4, t5, t6, t7, t8, t9, t10, "</tr>");
                $.get("/api/dispecerSveVoznje", function (data, status) {
                    var i;
                    var tip;
                    var tipVoznje;
                    for (i = 0; i < data.length; i++) {
                        var s1 = $("<td></td>").text(data[i].Odrediste.Adresa);
                        var s2 = $("<td></td>").text(data[i].Datum);
                        if (data[i].TipVozila == 0) {
                            tip = "Putnicki";
                        }
                        else if (data[i].TipVozila == 1) {
                            tip = "Kombi";
                        }
                        else if (data[i].TipVozila == 2) {
                            tip = "Podrazumevani";
                        }
                        var s3 = $("<td></td>").text(tip);
                        var s4 = $("<td></td>").text(data[i].Musterija);
                        var s5 = $("<td></td>").text(data[i].Vozac);
                        var s6 = $("<td></td>").text(data[i].Iznos);
                        if (data[i].StatusVoznje == 0) {
                            tipVoznje = "Kreirana";
                        }
                        else if (data[i].StatusVoznje == 1) {
                            tipVoznje = "Otkazana";
                        }
                        else if (data[i].StatusVoznje == 2) {
                            tipVoznje = "Formirana";
                        }
                        else if (data[i].StatusVoznje == 3) {
                            tipVoznje = "Odradjena";
                        }
                        else if (data[i].StatusVoznje == 4) {
                            tipVoznje = "Prihvacena";
                        }
                        else if (data[i].StatusVoznje == 5) {
                            tipVoznje = "Neuspesna";
                        }
                        else if (data[i].StatusVoznje == 6) {
                            tipVoznje = "Uspesna";
                        }
                        var s7 = $("<td></td>").text(tipVoznje);
                        var s8 = $("<td></td>").text(data[i].Komentar.Opis);
                        var s9 = $("<td></td>").text(data[i].Komentar.DatumObjave);
                        var s10 = $("<td></td>").text(data[i].Komentar.OcenaVoznje);

                        $("#tabelaPocetna2").append("<tr>", s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, "</tr>");
                    }
                });
            });
            $("#obradi").click(function () {
                $("#obradiVoznjuTabela").empty();
                $("#obradiVoznjuTabela").append("<tr><th colspan=\"3\" align=\"center\">Voznje na cekanju</th></tr>");
                $("#obradiVoznjuTabela").append("<tr><th>Ulica</th><th>Broj</th><th></th></tr>");


                $.get("/api/dispecerObradaVoznje", function (data, status) {
                    var i;

                    for (i = 0; i < data.length; i++) {
                        var txt1 = $("<td><input type=\"text\" readonly value=\"" + data[i].LokacijaTaksija.Adresa + "\" id=\"ulica" + i + "\"></td>").text(data[i].LokacijaTaksija.Adresa);
                        var txt3 = $("<td><input type=\"radio\" name=\"radioButton\"id=\"check" + i + "\"></td>");
                        $("#obradiVoznjuTabela").append("<tr>", txt1, txt3, "</tr>");
                    }
                });

                $.get("/api/vozaci", function (data, status) {
                    var i;

                    for (i = 0; i < data.length; i++) {
                        var txt1 = $("<option value=\"" + data[i].KorisnickoIme + "\" >" + data[i].KorisnickoIme + "</option>").text(data[i].KorisnickoIme);
                        $("#obradiVoznjuVozac").append(txt1);
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>DISPECER</h1>
    <!-- Tab links -->

    <button class="tablink" id="pocetna" onclick="openPage('Pocetna', this)">Pocetna</button>
    <button class="tablink" id="Myprofile" onclick="openPage('My Profile', this)">My Profile</button>
    <button class="tablink" id="FormirajVoznjuTab" onclick="openPage('Formiraj voznju', this)">Formiraj voznju</button>
    <button class="tablink" id="obradi" onclick="openPage('Obradi voznju', this)">Obradi voznju</button>
    <button class="tablink" onclick="openPage('Napravi vozaca', this)">Napravi vozaca</button>

    <div id="Napravi vozaca" class="tabcontent">
        <p>
            <form method="post" id="kreirajVozacaId">
                <table>
                    <tr>
                        <th colspan="2" align="center">Podaci vozaca</th>
                    </tr>
                    <tr>
                        <th>Korisnicko ime: </th>
                        <td><input type="text" name="korisnickoIme" id="korisnickoIme2"></td>
                    </tr>
                    <tr>
                        <th>Lozinka: </th>
                        <td><input type="text" name="lozinka" id="lozinka2"></td>
                    </tr>
                    <tr>
                        <th>Ime: </th>
                        <td><input type="text" name="ime" id="ime2"></td>
                    </tr>
                    <tr>
                        <th>Prezime: </th>
                        <td><input type="text" name="prezime" id="prezime2"></td>
                    </tr>
                    <tr>

                        <th>Pol: </th>
                        <td>
                            <select id="pol2" name="pol">
                                <option value="Muski" id="Muski">Muski</option>
                                <option selected value="Zenski" id="Zenski">Zenski</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>JMBG: </th>
                        <td><input type="text" name="jmbg" id="jmbg2"></td>
                    </tr>
                    <tr>
                        <th>Kontakt telefon: </th>
                        <td><input type="text" name="kontaktTelefon" id="kontaktTelefon2"></td>
                    </tr>
                    <tr>
                        <th>E-mail: </th>
                        <td><input type="text" name="email" id="email2"></td>
                    </tr>
                    <tr><input type="hidden" name="uloga" value="Vozac"></tr>
                    <tr>
                        <td colspan="2" align="center"><input type="submit" value="Sačuvaj"></td>
                    </tr>
                </table>
                
            </form>
            <script>
                kreirajVozaca();
            </script>
        </p>
    </div>

    <div id="My Profile" class="tabcontent">
        <h3>My Profile</h3>
        <p>
            <form method="post" id="izmenaDispecera">
                <table>
                    <tr>
                        <th colspan="2" align="center">Vaši podaci</th>
                    </tr>
                    <tr>
                        <th>Korisnicko ime: </th>
                        <td><input type="text" readonly name="korisnickoIme" id="korisnickoIme"></td>
                    </tr>
                    <tr>
                        <th>Lozinka: </th>
                        <td><input type="text" name="lozinka" id="lozinka"></td>
                    </tr>
                    <tr>
                        <th>Ime: </th>
                        <td><input type="text" name="ime" id="ime"></td>
                    </tr>
                    <tr>
                        <th>Prezime: </th>
                        <td><input type="text" name="prezime" id="prezime"></td>
                    </tr>
                    <tr>

                        <th>Pol: </th>
                        <td>
                            <select id="pol" name="pol">
                                <option value="Muski" id="Muski">Muski</option>
                                <option value="Zenski" id="Zenski">Zenski</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>JMBG: </th>
                        <td><input type="text" name="jmbg" id="jmbg"></td>
                    </tr>
                    <tr>
                        <th>Kontakt telefon: </th>
                        <td><input type="text" name="kontaktTelefon" id="kontaktTelefon"></td>
                    </tr>
                    <tr>
                        <th>E-mail: </th>
                        <td><input type="text" name="email" id="email"></td>
                    </tr>
                    <tr>
                        <th>Uloga: </th>
                        <td>
                            <select id="uloga" name="uloga">
                                <option value="Musterija">Musterija</option>
                                <option value="Vozac">Vozac</option>
                                <option value="Dispecer">Dispecer</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>Voznje: </th>
                        <td><input type="text" name="voznjeKorisnika"></td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center"><input type="submit" value="Sačuvaj"></td>
                    </tr>
                </table>
            </form>
            <script>
                validatePromenaDispecer();
            </script>
        </p>
    </div>

    <div id="Pocetna" class="tabcontent">
        <h1>                                    SVE VASE VOZNJE</h1>
        <table id="tabelaPocetna" border="1">
            
        </table>

        <h1>                                    SVE VOZNJE</h1>
        <table id="tabelaPocetna2" border="1">

        </table>
    </div>

    <div id="Formiraj voznju" class="tabcontent">
        <table border="1">
            <tr>
                <th>
                    Lokacija
                </th>
                <td>
                    <input type="text" name="lokacija" id="lokacijaVoznje">
                </td>
            </tr>
            <tr>
                <th>
                    Vozilo
                </th>
                <td>
                    <select id="tipAutomobila" name="Automobil.tipAutomobila">
                        <option value="Podrazumevani" id="PodrazumevaniZahtev">Podrazumevani</option>
                        <option value="Putnicki" id="PutnickiZahtev">Putnicki</option>
                        <option value="Kombi" id="KombiZahtev">Kombi</option>
                    </select>
                </td>
            </tr>
            <tr>
                <th>
                    Vozac
                </th>
                <td>
                    <select id="vozacSelect" name="Vozac">
                    </select>
                </td>
            </tr>
            <tr>
                <td colspan="2">
                    <input type="submit" name="submit" id="dugme" onclick="formiraj()">
                </td>
            </tr>
        </table>
    </div>

    <div id="Obradi voznju" class="tabcontent">
        <table id="obradiVoznjuTabela" border="1"></table>
        <select id="obradiVoznjuVozac"></select>
        <input type="submit" value="Obradi" onclick="obradi()">
    </div>
</body>
</html>