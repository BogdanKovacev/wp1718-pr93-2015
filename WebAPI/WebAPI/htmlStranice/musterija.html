<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="proba.css">

    <script src="Scripts/jquery-1.10.2.js"></script>
    <script src="Scripts/jquery.validate.js"></script>

    <script type="text/javascript">

        function openPage(pageName, elmnt, color) {
            // Hide all elements with class="tabcontent" by default */
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Remove the background color of all tablinks/buttons
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }

            // Show the specific tab content
            document.getElementById(pageName).style.display = "block";

            // Add the specific color to the button used to open the tab content
            elmnt.style.backgroundColor = color;
            
        }

        function pom(i)
        {
            var a = i

            $("#tabelaKomentar").show();
            var ret = $("#opis1").val();
            var s5 = $("<input type=\"submit\" value=\"Komentarisi\" onclick=\"kom(ret)\">").attr("id", "komentar_" + i);
            var s6 = $("<input type=\"submit\" value=\"Komentarisi\" onclick=\"kom(" + i + ")\">").attr("id", "izmeni_" + i);
            $("#tdKomentar").append(s6);

        }

        function kom(i)
        {
            alert($("#opis1").val());
            alert($("#ocenaVoznje1").val());
            $.ajax({
                url: 'api/komentar/post',
                method: 'POST',
                data: {
                    KorisnickoImeVozaca: $("#opis1").val(),
                    Lokacija2: i,
                    Ocena: $("#ocenaVoznje1").val()
                }
            });
            $("#tabelaKomentar").hide();

        }

        function pom2(i) {
            var a = i

            alert("POM2");
            $.ajax({
                url: 'api/izmenaVoznje/post',
                method: 'POST',
                data: {
                    KorisnickoImeVozaca: i
                },
                success: function (data) {
                    alert("success2");
                    document.getElementById("tab2").click();
                    $("#lokacijaZahtev").val(data.Odrediste.Adresa);
                    if (data.TipVozila == 0) {
                        $("#PutnickiZahtev").attr("selected", "true");
                    }
                    else if (data.TipVozila == 1) {
                        $("#KombiZahtev").attr("selected", "true");
                    }
                    else if (data.TipVozila == 2) {
                        $("#PodrazumevaniZahtev").attr("selected", "true");
                    }
                }             
            });
        }


    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            document.getElementById("tab2").click();
            $("#tab1").click(function () {
                $.get("/api/loggin", function (data, status) {
                    let ulogovaniKorisnik = JSON.parse(localStorage.getItem("ulogovan"));
                    $("#korisnickoIme").val(data.KorisnickoIme);
                    $("#korisnickoIme3").val(data.KorisnickoIme);
                    $("#ime").val(data.Ime);
                    $("#prezime").val(data.Prezime);
                    if (data.Pol == 0) {
                        $("#Muski").attr("selected", "true");
                    }
                    else {
                        $("#Zenski").attr("selected", "true");
                    }
                    $("#kontaktTelefon").val(data.KontaktTelefon);
                    $("#lozinka").val(data.Lozinka);
                    $("#jmbg").val(data.Jmbg);
                    $("#email").val(data.Email);
                    $("#uloga").val(data.Uloga);
                    $("#voznje").val(data.VoznjeKorisnika);
                });
            });
            $("#Voznje").click(function () {
                $("#tabelaKomentar").hide();
                $("#tabela").empty();
                var s1 = $("<th></th>").text("Lokacija");
                var s2 = $("<th></th>").text("Vreme porucivalja");
                var s3 = $("<th colspan=\"2\"></th>").text("Opcije");
                $("#tabela").append("<tr>", s1, s2, s3, "</tr>");
                $.get("/api/voznjeKorisnika", function (data, status) {
                    var i;
                    for (i = 0; i < data.length; i++) {
                        var o;
                        var iz;
                        var korisnik;
                        var txt2 = $("<td></td>").text(data[i].Odrediste.Adresa);
                        var txt3 = $("<td></td>").text(data[i].Datum);
                        var txt7 = $("<td></td>").text(i);
                        korisnik = data[i].Musterija;
                        $("#korisnikKomentar").val(korisnik);
                        var txt4 = $("<input type=\"submit\" value=\"izmeni\" onclick=\"pom2(" + i + ")\">").attr("id", "izmeni_" + i);
                        var txt5 = $("<input type=\"submit\" value=\"obrisi\" onclick=\"pom(" + i + ")\">").attr("id", "obrisi_" + i);
                        $("#tabela").append("<tr>", txt2, txt3, txt4, txt5,txt7, "</tr>");
                        
                        iz = i;
                        o = i;                        
                    }

                });
            });
            $("#sveVoznje").click(function () {
                $("#sveVoznjeMusterijaTabela").empty();
                var s1 = $("<th></th>").text("Adresa");
                var s4 = $("<th></th>").text("Dispecer");
                var s5 = $("<th></th>").text("Iznos");
                var s6 = $("<th></th>").text("Status voznje");
                var s7 = $("<th></th>").text("Vozac");
                $("#sveVoznjeMusterijaTabela").append("<tr>", s1, s4, s5, s6, s7, "</tr>");
                $.get("/api/sveVoznjeMusterija", function (data, status) {
                    var i;
                    var tipVoznje;
                    for (i = 0; i < data.length; i++) {
                        var txt1 = $("<td></td>").text(data[i].LokacijaTaksija.Adresa);
                        var txt4 = $("<td></td>").text(data[i].Dispecer);
                        var txt5 = $("<td></td>").text(data[i].Iznos);
                        if (data[i].StatusVoznje == 0) {
                            tipVoznje = "Kreirana";
                        }
                        else if (data[i].StatusVoznje == 1) {
                            tipVoznje = "Otkazana";
                        }
                        else if (data[i].StatusVoznje == 2) {
                            tipVoznje = "Formirana";
                        }
                        else if (data[i].StatusVoznje == 3) {
                            tipVoznje = "Odradjena";
                        }
                        else if (data[i].StatusVoznje == 4) {
                            tipVoznje = "Prihvacena";
                        }
                        else if (data[i].StatusVoznje == 5) {
                            tipVoznje = "Neuspesna";
                        }
                        else if (data[i].StatusVoznje == 6) {
                            tipVoznje = "Uspesna";
                        }
                        var txt7 = $("<td></td>").text(data[i].Vozac)
                        $("#sveVoznjeMusterijaTabela").append("<tr>", txt1, txt4, txt5, tipVoznje, txt7, "</tr>");
                    }
                });
            });
        });
    </script>
</head>
<body>
    <h1>MUSTERIJA</h1>
    <!-- Tab links -->

    <button class="tablink" id="tab1" onclick="openPage('My Profile', this)">My Profile</button>
    <button class="tablink" id="tab2" onclick="openPage('Zahtev za voznju', this)">Zahtev za voznju</button>
    <button class="tablink" id="Voznje" onclick="openPage('Voznje na cekanju', this)">Voznje na cekanju</button>
    <button class="tablink" id="sveVoznje" onclick="openPage('Sve voznje', this)" >Sve voznje</button>

    <div id="Sve voznje" class="tabcontent">
        <h1>                        SVE VASE VOZNJE </h1>
        <table id="sveVoznjeMusterijaTabela" border="1">

        </table>
    </div>

    <div id="My Profile" class="tabcontent">
        <h3>My Profile</h3>


        <form method="post" id="musterijaPromena">
            <p>
                <table>
                    <tr>
                        <th colspan="2" align="center">Vaši podaci</th>
                    </tr>
                    <tr>
                        <th>Korisnicko ime: </th>
                        <td><input type="text" readonly id="korisnickoIme" name="korisnickoIme"></td>
                    </tr>
                    <tr>
                        <th>Lozinka: </th>
                        <td><input type="text" id="lozinka" name="lozinka"></td>
                    </tr>
                    <tr>
                        <th>Ime: </th>
                        <td><input type="text" id="ime" name="ime"></td>
                    </tr>
                    <tr>
                        <th>Prezime: </th>
                        <td><input type="text" id="prezime" name="prezime"></td>
                    </tr>
                    <tr>

                        <th>Pol: </th>
                        <td>
                            <select id="pol" name="pol">
                                <option value="Muski" id="Muski">Muski</option>
                                <option value="Zenski" id="Zenski">Zenski</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>JMBG: </th>
                        <td><input type="text" id="jmbg" name="jmbg"></td>
                    </tr>
                    <tr>
                        <th>Kontakt telefon: </th>
                        <td><input type="text" id="kontaktTelefon" name="kontaktTelefon"></td>
                    </tr>
                    <tr>
                        <th>E-mail: </th>
                        <td><input type="text" id="email" name="email"></td>
                    </tr>
                    <tr>
                        <td colspan="2" align="center"><input type="submit" value="Sačuvaj"></td>
                    </tr>
                </table>
            </p>
        </form>
        <script>
            validatePromena();
        </script>

    </div>
    <div id="Zahtev za voznju" class="tabcontent">
        <form method="post" id="idZahtev">
            <table border="1">
                <tr>
                    <th>Unesite lokaciju:</th>
                    <td><input type="text" id="lokacijaZahtev" name="Lokacija.adresa"><input type="hidden" name="korisnickoIme3" id="korisnickoIme3"></td>
                </tr>
                <tr>
                    <th>Vozilo:</th>
                    <td>
                        <select id="tipAutomobilaZahtev" name="Automobil.tipAutomobila">
                            <option value="Podrazumevani" id="PodrazumevaniZahtev">Podrazumevani</option>
                            <option value="Putnicki" id="PutnickiZahtev">Putnicki</option>
                            <option value="Kombi" id="KombiZahtev">Kombi</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" align="center"><input type="submit" value="Naruci"></td>
                </tr>
            </table>
        </form>
        <script>
            ZahtevValidate();
        </script>
    </div>


    <div id="Voznje na cekanju" class="tabcontent">
            <table border="1" id="tabela">
                
            </table>

            <table border="1" id="tabelaKomentar">
                <tr>
                    <th>Ocena</th>
                    <td>
                        <select id="ocenaVoznje1" name="ocenaVoznje">
                            <option value="Nula">0</option>
                            <option value="Jedan">1</option>
                            <option value="Dva">2</option>
                            <option value="Tri">3</option>
                            <option value="Cetiri">4</option>
                            <option value="Pet">5</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>Opis</th>
                    <td>
                        <input type="text" id="opis1" name="opis">
                    </td>
                </tr>
                <tr>
                    <th>Korisnik</th>
                    <td>
                        <input readonly type="text" name="korisnikKomentar" id="korisnikKomentar">
                    </td>
                </tr>
                <tr>
                    <td colspan="2" align="center" id="tdKomentar">
                        
                    </td>
                </tr>
            </table>
    </div>

</body>
</html>